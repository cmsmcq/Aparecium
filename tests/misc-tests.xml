<tc:test-catalog xmlns:tc="https://github.com/cmsmcq/ixml-tests"
                 xmlns:ixml="http://invisiblexml.org/NS"
		 name="Miscellany"
		 release-date="2022-02-17"
		 >
  <tc:description>
    <tc:p>Contains tests accumulated bit by bit from discussions
    in the community group and other sources.</tc:p>
  </tc:description>

  <tc:test-set name="bibtex">
    <tc:created by="CMSMcQ" on="2022-02-17"/>
    <tc:description>
      <tc:p>From Norm Walsh, in mail to public-ixml on 16 Feb 2022:
      https://lists.w3.org/Archives/Public/public-ixml/2022Feb/0161.html
      </tc:p>
    </tc:description>
    
    <tc:ixml-grammar>
bibtex: item+itemsep, s* .
itemsep: s+ .

-item: comment ; entry .

comment: -"%", cchar* .

entry: -"@", @type, s*, -'{', s*, @citekey, fields?, s* -'}' .

type: -name .
citekey: -name .

-fields: -',', field+fsep .

field: s*, name, s*, -'=', s*, value .
value: quotedvalue; bracedvalue; atomicvalue .

-quotedvalue: -'"', qvalue, -'"' .
-bracedvalue: -'{', bvalue, -'}' .
-atomicvalue: ["0"-"9"]+ .

qvalue: qchar* .
bvalue: bchar* .

-fsep: s*, -',', s* .

name: namestart, namefollower* .

-cchar: ~[#a] .
-qchar: ~['"'] .
-bchar: ~['}'] .
-namestart: ["_"; L] .
-namefollower: namestart; ["-.·‿⁀"; Nd; Mn] .

-s: (-[Zs]; -#9; -#d; -#a) .
    </tc:ixml-grammar>

    <tc:test-case name="t1">
      <tc:description>
	<tc:p>Norm reports that this input should succeed.</tc:p>
      </tc:description>
      
      <tc:test-string>%C
@Book{K,
  t = "a"
}

@Book{K,
  t = "a"
}
</tc:test-string>    
    
      <tc:result>
	<tc:assert-xml>
	  <bibtex
            ><comment>C</comment
            ><itemsep
            /><entry type="Book" citekey="K"
              ><field
                ><name>t</name
                ><value
                  ><qvalue>a</qvalue
                ></value
              ></field
            ></entry
            ><itemsep
            /><entry type="Book" citekey="K"
              ><field
                ><name>t</name
                ><value
                  ><qvalue>a</qvalue
                ></value
              ></field
            ></entry
          ></bibtex
	></tc:assert-xml
      ></tc:result
    ></tc:test-case>

    <tc:test-case name="t2">
      <tc:description>
	<tc:p>Norm reports that this input is failing.</tc:p>
      </tc:description>
      
      <tc:test-string>%C
@Book{K,
  t = "a"
}
@Book{K,
  t = "a"
}
</tc:test-string>    
    
      <tc:result>
	<tc:assert-not-a-sentence/>
      </tc:result>
    </tc:test-case>
  </tc:test-set>

  <tc:test-set name="Kings-01">
    <tc:created on="2022-03-17" by="CMSMcQ"/>
    <tc:description>
      <tc:p>Illustrates the point that the class of unused
      nonterminals is broader than the class of unreferenced
      nonterminals.  The ixml spec defines unreferenced nonterminals (other th)</tc:p>
    </tc:description>

    <tc:ixml-grammar>
S: A .
A: 'a', B ; 'x' .
B: 'b', A ; LDOE, A .
LDOE: M; 'l' .
M: 'm'; LDOE .
    </tc:ixml-grammar>
    <tc:test-case name="t1">
      <tc:test-string>amalx</tc:test-string>
      <tc:result>
	<tc:assert-xml>
	  <S ixml:state="ambiguous"><A>a<B><LDOE><M>m</M>l</LDOE><A></A></B></A></S>
	</tc:assert-xml>
	<tc:assert-xml>
	  <S ixml:state="ambiguous"
            ><A>a<B
	    ><LDOE
              ><M>m</M
            ></LDOE
            ><A>a<B
            ><LDOE
              ><M
		><LDOE
                  ><M
                    ><LDOE>l</LDOE
                  ></M
                ></LDOE
              ></M
            ></LDOE
            ><A>x</A
            ></B></A
            ></B></A
	  ></S>
	</tc:assert-xml>
	<tc:assert-xml>
	  <S xmlns:ixml="http://invisiblexml.org/NS" ixml:state="ambiguous"
	    ><A>a<B
	    ><LDOE
              ><M
		><LDOE
		  ><M>m</M
		></LDOE
              ></M
	    ></LDOE
	    ><A>a<B
            ><LDOE
              ><M
		><LDOE
                  ><M
                    ><LDOE>l</LDOE
                  ></M
		></LDOE
              ></M
            ></LDOE
            ><A>x</A
          ></B
	    ></A
	  ></B
	    ></A
	  ></S>
	</tc:assert-xml>
      </tc:result>
    </tc:test-case>
  </tc:test-set>

  <tc:test-set name="ambiguous-markings">
    <tc:created on="2022-04-16" by="CMSMcQ"/>
    <tc:ixml-grammar>
      S = a; -a; ^a; @a.
      a = 'a'
    </tc:ixml-grammar>
    <tc:grammar-test>
      <tc:result>
	<tc:assert-xml>
	  <ixml
	    ><rule name="S"
	      ><alt><nonterminal name="a"/></alt
	      ><alt><nonterminal name="a" mark="-"/></alt
	      ><alt><nonterminal name="a" mark="^"/></alt
	      ><alt><nonterminal name="a" mark="@"/></alt
	    ></rule
	  ></ixml>
	</tc:assert-xml>
      </tc:result>
    </tc:grammar-test>
    <tc:test-case name="a">
      <tc:test-string>a</tc:test-string>
      <tc:result>
	<tc:assert-xml><S ixml:state="ambiguous"><a>a</a></S></tc:assert-xml>
	<tc:assert-xml><S ixml:state="ambiguous">a</S></tc:assert-xml>
	<tc:assert-xml><S ixml:state="ambiguous" a="a"/></tc:assert-xml>
      </tc:result>
    </tc:test-case>
  </tc:test-set>
  
</tc:test-catalog>
